stages:
  - prepare
  - build
  - test
  
main_prepare:
  only:
    - main
  stage: prepare
  tags:
    - FreeBSD
  script:
    - pkg info | grep cunit
    - pkg infi | grep valgrind

main_build:
    only:
      - main
    stage: build
    tags: 
      - FreeBSD
    script:
      - gmake debug release test

main_test:
    stage: test
    only:
      - main
    tags:
      - FreeBSD
    dependencies:
      - main_build
    script:
      valgrind --leak-check=full --error-exitcode=1 wallmon_test